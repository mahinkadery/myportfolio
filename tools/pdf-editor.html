<!DOCTYPE html>
<html lang="en" class="light">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>PDF Text Editor – Replace Text in PDF Files | toolfoliohub</title>
  <meta name="description" content="Edit and replace text inside PDF documents using our true PDF engine. Find and replace specific text on any page. Free PDF text editor tool.">
  <meta name="keywords" content="PDF text editor, edit PDF text, replace text in PDF, PDF find and replace, modify PDF text, PDF editing tool">
  <meta property="og:title" content="PDF Text Editor – Replace Text in PDF Files | toolfoliohub">
  <meta property="og:description" content="Edit and replace text directly inside PDF documents. True PDF engine that modifies the actual text, not overlays.">
  <script src="https://cdn.tailwindcss.com?plugins=forms,typography"></script>
  <script src="../tailwind-theme.js"></script>
  <link rel="stylesheet" href="../styles.css"/>
  <script src="https://unpkg.com/@studio-freight/lenis@1.0.42/dist/lenis.min.js"></script>
  
  <!-- PDF.js (Stable Version) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
  <script>
    // Define the worker source immediately to ensure it's available
    // Use a hardcoded version matching the library script
    window.pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
  </script>

  <link rel="apple-touch-icon" sizes="180x180" href="/favicon_io/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon_io/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon_io/favicon-16x16.png">
  <link rel="manifest" href="/favicon_io/site.webmanifest">
  <link rel="shortcut icon" href="/favicon_io/favicon.ico">
  <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" rel="stylesheet"/>
  <style>
    .tool-shell { max-width: 1200px; margin: 0 auto; }
    .pdf-page-wrapper { position: relative; margin-bottom: 2rem; box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1); }
    .text-layer { position: absolute; top: 0; left: 0; right: 0; bottom: 0; overflow: hidden; line-height: 1.0; pointer-events: none; }
    .text-layer > span { 
      position: absolute; 
      color: transparent; 
      transform-origin: 0% 0%; 
      white-space: pre; 
      cursor: text; 
      pointer-events: auto;
    }
    .text-layer > span:hover {
      outline: 1px solid rgba(59, 130, 246, 0.5);
      background-color: rgba(59, 130, 246, 0.1);
    }
    .text-layer > span.edited {
      background-color: rgba(251, 191, 36, 0.3); /* Amber for edited */
      color: black; /* Show text for edited items */
      border-bottom: 2px solid #f59e0b;
    }
    .dark .text-layer > span.edited {
      color: white;
    }
    /* When editing, show the text clearly */
    .text-layer > span:focus {
      color: black !important;
      background-color: white !important;
      outline: 2px solid #3b82f6;
      z-index: 10;
      min-width: 10px;
    }
  </style>
</head>
<body class="bg-background-light dark:bg-background-dark text-text-light dark:text-text-dark font-display dotted-bg">
  <div class="min-h-screen flex flex-col">
    <!-- Header -->
    <header class="w-full max-w-5xl mx-auto mt-6 rounded-full glass-effect px-6 py-3 flex items-center justify-between shadow-lg z-50 relative">
      <a href="/" class="flex items-center gap-3">
        <img src="../website-logos/headerlogoTFB.png" alt="toolfoliohub" class="h-8 w-auto dark:hidden">
        <img src="../website-logos/Toolfoliohubdarkmodelogo.png" alt="toolfoliohub" class="h-8 w-auto hidden dark:block">
        <span class="brand-title text-xs sm:text-sm">toolfoliohub</span>
      </a>
      <div class="flex items-center gap-4">
        <a href="/tools" class="text-sm font-semibold text-primary">⬅ Back to Tools</a>
        <button id="darkModeToggle" class="p-2 rounded-full hover:bg-black/5 dark:hover:bg-white/5 transition-colors">
          <span class="material-symbols-outlined text-text-light dark:text-text-dark">dark_mode</span>
        </button>
      </div>
    </header>

    <main class="flex-1 px-4 py-10">
      <section class="tool-shell rounded-3xl glass-effect p-6 shadow-xl space-y-6">
        
        <!-- Top Bar: Title & Controls -->
        <div class="flex flex-col lg:flex-row gap-6 items-start lg:items-center justify-between border-b border-gray-200 dark:border-gray-700 pb-6">
          <div class="max-w-xl">
            <div class="flex items-center gap-2 mb-1">
              <p class="text-xs uppercase tracking-[0.4em] text-muted-light dark:text-muted-dark">PDF Tools</p>
              <span class="px-2 py-0.5 rounded-full bg-primary/10 text-primary text-[10px] font-bold tracking-wide">VISUAL EDITOR</span>
            </div>
            <h1 class="text-2xl font-bold">PDF Text Editor</h1>
            <p class="text-sm text-muted-light dark:text-muted-dark mt-1">Click text directly on the PDF preview to edit it. Changes are applied by a server-side PDF engine, not just overlays.</p>
          </div>

          <div class="flex flex-col sm:flex-row gap-3 w-full lg:w-auto">
            <label class="flex items-center gap-2 cursor-pointer bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-xl px-4 py-2 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors">
              <span class="material-symbols-outlined text-primary">upload_file</span>
              <span class="text-sm font-medium">Choose PDF</span>
              <input type="file" id="pdfFile" accept="application/pdf" class="hidden">
            </label>
            
            <button id="clearBtn" class="hidden px-4 py-2 rounded-xl border border-red-200 text-red-600 hover:bg-red-50 dark:border-red-900/50 dark:text-red-400 dark:hover:bg-red-900/20 text-sm font-medium transition-colors">
              Clear changes
            </button>

            <button id="applyBtn" disabled class="flex items-center gap-2 px-5 py-2 rounded-xl bg-primary text-white font-medium text-sm hover:bg-primary/90 disabled:opacity-50 disabled:cursor-not-allowed transition-all shadow-sm">
              <span class="material-symbols-outlined text-[18px]">save_as</span>
              Apply & Download
            </button>
          </div>
        </div>

        <!-- Info Bar / Status -->
        <div class="flex flex-col sm:flex-row justify-between items-center gap-4 bg-white/50 dark:bg-black/20 rounded-xl p-3 text-sm">
          <div id="fileInfo" class="text-muted-light dark:text-muted-dark font-medium truncate max-w-xs">No file selected</div>
          <div id="status" aria-live="polite" class="flex items-center gap-2 font-medium">
            <span class="material-symbols-outlined text-blue-500 text-[18px]">info</span>
            <span class="text-blue-700 dark:text-blue-300">Ready – upload a PDF to begin.</span>
          </div>
          <div id="editCountBadge" class="hidden px-3 py-1 bg-amber-100 dark:bg-amber-900/30 text-amber-700 dark:text-amber-300 rounded-full text-xs font-bold">
            0 edits pending
          </div>
        </div>

        <!-- PDF Viewer Container -->
        <div id="pdfContainer" class="w-full bg-gray-100 dark:bg-gray-900/50 rounded-xl border border-gray-200 dark:border-gray-700 min-h-[400px] max-h-[800px] overflow-y-auto p-4 flex flex-col items-center gap-4 relative">
          <div id="placeholder" class="absolute inset-0 flex flex-col items-center justify-center text-muted-light dark:text-muted-dark pointer-events-none">
            <span class="material-symbols-outlined text-6xl mb-4 opacity-20">picture_as_pdf</span>
            <p class="opacity-50">Upload a PDF to start editing text visually</p>
          </div>
        </div>

      </section>

      <!-- SEO Article Section -->
      <article class="tool-shell rounded-3xl glass-effect p-8 md:p-12 shadow-xl prose dark:prose-invert max-w-none mt-10 mb-12">
        <style>
          .prose { max-width: none; }
          .dark .prose { color: #d1d5db; }
          .dark .prose h2, .dark .prose h3, .dark .prose strong { color: #f3f4f6; }
          .dark .prose a { color: #60a5fa; }
        </style>
        
        <h2>PDF Text Editor – True Text Replacement in PDF Documents</h2>
        
        <p class="lead">
          Need to correct a typo, update a date, or change a name in a PDF document? The <strong>PDF Text Editor</strong> uses a true PDF editing engine to find and replace text directly within your PDF files – not just overlay new text on top.
        </p>
        <p>
          Unlike simple annotation tools that add text boxes over existing content, this tool modifies the actual PDF text content while preserving document structure, fonts, and formatting.
        </p>

        <h2>Why Use a True PDF Text Editor?</h2>
        <p>
          Traditional PDF "editors" often just add overlays or annotations. This tool actually modifies the underlying PDF content:
        </p>
        <ul>
          <li><strong>True Text Replacement:</strong> Changes the actual text in the PDF structure</li>
          <li><strong>Visual Editing:</strong> Click and edit text directly on the document preview</li>
          <li><strong>Preserved Formatting:</strong> Maintains original document layout and fonts</li>
          <li><strong>Professional Output:</strong> Edited PDFs look like they were created that way</li>
        </ul>

        <h2>How PDF Text Editing Works</h2>
        
        <h3>1. Upload Your PDF</h3>
        <p>
          Select the PDF file you want to edit. The tool renders a visual preview of your document directly in the browser.
        </p>

        <h3>2. Click to Edit</h3>
        <p>
          Simply click on any text element in the preview. The text becomes editable instantly. Type your changes and click away to save them.
        </p>

        <h3>3. Apply & Download</h3>
        <p>
          Once you've made all your edits, click "Apply & Download". Our secure engine processes the file and delivers your updated PDF.
        </p>

        <h2>Privacy & Security</h2>
        <p>
          Your PDF is sent to our secure processing server ONLY when you click "Apply & Download". We do not store your documents after processing is complete. The visual preview happens entirely in your browser.
        </p>
      </article>
    </main>
  </div>

  <script>
    // --- Configuration ---
    // Ensure pdfjsLib is defined
    const pdfjsLib = window.pdfjsLib;
    // Worker source is already set in the head script
    const EDIT_ENDPOINT = 'https://pdf-engine-1wkl.onrender.com/edit';

    // --- State ---
    let currentFile = null;
    let currentPdf = null;
    let edits = []; // Array of { pageIndex, oldText, newText, spanRef }
    const SCALE = 1.5; // Render scale for better quality

    // --- Helpers ---
    // Matrix multiplication helper to replace pdfjsLib.Util.transform
    function transform(m1, m2) {
      return [
        m1[0] * m2[0] + m1[2] * m2[1],
        m1[1] * m2[0] + m1[3] * m2[1],
        m1[0] * m2[2] + m1[2] * m2[3],
        m1[1] * m2[2] + m1[3] * m2[3],
        m1[0] * m2[4] + m1[2] * m2[5] + m1[4],
        m1[1] * m2[4] + m1[3] * m2[5] + m1[5]
      ];
    }

    // --- Elements ---
    const pdfFile = document.getElementById('pdfFile');
    const pdfContainer = document.getElementById('pdfContainer');
    const placeholder = document.getElementById('placeholder');
    const fileInfo = document.getElementById('fileInfo');
    const applyBtn = document.getElementById('applyBtn');
    const clearBtn = document.getElementById('clearBtn');
    const statusEl = document.getElementById('status');
    const editCountBadge = document.getElementById('editCountBadge');

    // --- Event Listeners ---
    if (pdfFile) pdfFile.addEventListener('change', handleFileSelect);
    if (applyBtn) applyBtn.addEventListener('click', handleApply);
    if (clearBtn) clearBtn.addEventListener('click', handleClear);

    // --- Functions ---

    function updateStatus(msg, type = 'info') {
      const colors = {
        info: 'text-blue-700 dark:text-blue-300',
        success: 'text-green-700 dark:text-green-300',
        error: 'text-red-700 dark:text-red-300',
        loading: 'text-amber-700 dark:text-amber-300'
      };
      const icons = {
        info: 'info',
        success: 'check_circle',
        error: 'error',
        loading: 'progress_activity'
      };
      
      const iconClass = type === 'loading' ? 'animate-spin' : '';
      const colorClass = colors[type] || colors.info;
      const iconName = icons[type] || 'info';

      statusEl.innerHTML = `
        <span class="material-symbols-outlined ${iconClass} ${colorClass.split(' ')[0]} text-[18px]">${iconName}</span>
        <span class="${colorClass}">${msg}</span>
      `;
    }

    async function handleFileSelect(e) {
      const file = e.target.files[0];
      if (!file) return;

      currentFile = file;
      fileInfo.textContent = `${file.name} (${(file.size / 1024 / 1024).toFixed(2)} MB)`;
      placeholder.style.display = 'none';
      pdfContainer.innerHTML = ''; // Clear previous
      edits = [];
      updateEditCount();
      clearBtn.classList.add('hidden');
      applyBtn.disabled = true;
      
      updateStatus('Rendering PDF...', 'loading');

      try {
        if (!pdfjsLib) {
          throw new Error('PDF.js library not loaded. Please refresh the page.');
        }

        const arrayBuffer = await file.arrayBuffer();
        const loadingTask = pdfjsLib.getDocument({ data: arrayBuffer });
        currentPdf = await loadingTask.promise;
        
        // Render all pages
        for (let pageNum = 1; pageNum <= currentPdf.numPages; pageNum++) {
          await renderPage(pageNum);
        }
        
        updateStatus('Ready – click text to edit.', 'success');
      } catch (error) {
        console.error('Error loading PDF:', error);
        updateStatus(`Error: ${error.message}`, 'error');
        placeholder.style.display = 'flex';
      }
    }

    async function renderPage(pageNum) {
      const page = await currentPdf.getPage(pageNum);
      const viewport = page.getViewport({ scale: SCALE });

      // Wrapper
      const pageWrapper = document.createElement('div');
      pageWrapper.className = 'pdf-page-wrapper';
      pageWrapper.style.width = `${viewport.width}px`;
      pageWrapper.style.height = `${viewport.height}px`;

      // Canvas
      const canvas = document.createElement('canvas');
      canvas.width = viewport.width;
      canvas.height = viewport.height;
      const ctx = canvas.getContext('2d');

      pageWrapper.appendChild(canvas);
      pdfContainer.appendChild(pageWrapper);

      // Render PDF to Canvas
      await page.render({ canvasContext: ctx, viewport }).promise;

      // Text Layer
      const textLayer = document.createElement('div');
      textLayer.className = 'text-layer';
      pageWrapper.appendChild(textLayer);

      // Get Text Content
      const textContent = await page.getTextContent();
      
      // Render text items
      textContent.items.forEach(item => {
        // Use custom transform helper instead of pdfjsLib.Util.transform
        const tx = transform(viewport.transform, item.transform);
        
        // Calculate font size based on transform matrix
        // This approximates the font height in canvas pixels
        const fontHeight = Math.sqrt((tx[2] * tx[2]) + (tx[3] * tx[3]));
        
        // Create span
        const span = document.createElement('span');
        span.textContent = item.str;
        span.dataset.original = item.str; // Store original text
        span.dataset.pageIndex = pageNum - 1; // 0-based index
        
        // Style positioning
        span.style.left = `${tx[4]}px`;
        span.style.top = `${tx[5] - fontHeight}px`; // Adjust for baseline (approx)
        span.style.fontSize = `${fontHeight}px`;
        span.style.fontFamily = 'sans-serif'; // Fallback
        
        // Only add if text is not empty
        if (item.str.trim().length > 0) {
            span.addEventListener('click', handleSpanClick);
            textLayer.appendChild(span);
        }
      });
    }

    function handleSpanClick(e) {
      const span = e.target;
      if (span.isContentEditable) return;

      // Enable editing
      span.contentEditable = true;
      span.focus();
      
      // Select all text for easier replacement
      document.execCommand('selectAll', false, null);

      // Save handlers to remove them later
      const blurHandler = () => finishEditing(span);
      const keyHandler = (evt) => {
        if (evt.key === 'Enter') {
          evt.preventDefault();
          span.blur(); // Triggers blurHandler
        }
      };

      span.addEventListener('blur', blurHandler, { once: true });
      span.addEventListener('keydown', keyHandler);
      
      // Attach to span to remove listener if needed
      span._keyHandler = keyHandler;
    }

    function finishEditing(span) {
      span.contentEditable = false;
      span.removeEventListener('keydown', span._keyHandler);
      
      const newText = span.textContent; // keep whitespace
      const oldText = span.dataset.original;
      const pageIndex = parseInt(span.dataset.pageIndex);

      // Logic:
      // If text changed from original, register edit.
      // If text reverted to original, remove edit.
      
      if (newText !== oldText) {
        registerEdit(pageIndex, oldText, newText, span);
        span.classList.add('edited');
      } else {
        removeEdit(pageIndex, oldText);
        span.classList.remove('edited');
      }
      
      updateUIState();
    }

    function registerEdit(pageIndex, oldText, newText, spanRef) {
      // Check if we already have an edit for this specific original text on this page
      const existingIndex = edits.findIndex(e => e.pageIndex === pageIndex && e.oldText === oldText);
      
      if (existingIndex >= 0) {
        edits[existingIndex].newText = newText;
      } else {
        edits.push({ pageIndex, oldText, newText });
      }
    }

    function removeEdit(pageIndex, oldText) {
      edits = edits.filter(e => !(e.pageIndex === pageIndex && e.oldText === oldText));
    }

    function updateUIState() {
      updateEditCount();
      
      if (edits.length > 0) {
        applyBtn.disabled = false;
        clearBtn.classList.remove('hidden');
        updateStatus(`Ready to apply ${edits.length} change${edits.length !== 1 ? 's' : ''}.`);
      } else {
        applyBtn.disabled = true;
        clearBtn.classList.add('hidden');
        updateStatus('Ready – click text to edit.');
      }
    }

    function updateEditCount() {
      if (edits.length > 0) {
        editCountBadge.textContent = `${edits.length} edit${edits.length !== 1 ? 's' : ''} pending`;
        editCountBadge.classList.remove('hidden');
      } else {
        editCountBadge.classList.add('hidden');
      }
    }

    function handleClear() {
      if (!confirm('Discard all changes?')) return;
      
      // Reload the file effectively
      handleFileSelect({ target: { files: [currentFile] } });
    }

    async function handleApply() {
      if (!currentFile || edits.length === 0) return;

      applyBtn.disabled = true;
      updateStatus('Sending edits to server...', 'loading');

      const payload = {
        edits: edits.map(e => ({
          page: e.pageIndex,
          oldText: e.oldText,
          newText: e.newText
        }))
      };

      const formData = new FormData();
      formData.append('file', currentFile);
      formData.append('edits', JSON.stringify(payload));

      try {
        const response = await fetch(EDIT_ENDPOINT, {
          method: 'POST',
          body: formData
        });

        if (!response.ok) {
          const errText = await response.text();
          throw new Error(errText || 'Server error');
        }

        // Download
        const blob = await response.blob();
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'edited_document.pdf';
        document.body.appendChild(a);
        a.click();
        a.remove();
        URL.revokeObjectURL(url);

        updateStatus('Success – downloading edited PDF.', 'success');
        
        // Optional: Reset after download?
        // For now, leave it so user can edit more if they want.
        applyBtn.disabled = false;

      } catch (error) {
        console.error('Apply error:', error);
        updateStatus(`Error: ${error.message}`, 'error');
        applyBtn.disabled = false;
      }
    }
  </script>
  <script src="../tools-shared-script.js"></script>
</body>
</html>
