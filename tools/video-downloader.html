<!DOCTYPE html>
<html lang="en" class="light">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Apify URL Tool – toolfoliohub</title>
  <script src="https://cdn.tailwindcss.com?plugins=forms,typography"></script>
  <script src="../tailwind-theme.js"></script>
  <link rel="stylesheet" href="../styles.css"/>
  <link rel="icon" type="image/svg+xml" href="../favicon.svg"/>
  <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" rel="stylesheet"/>
  <style>
    .tool-shell {
      max-width: 720px;
      margin: 0 auto;
    }
  </style>
</head>
<body class="bg-background-light dark:bg-background-dark text-text-light dark:text-text-dark font-display dotted-bg">
  <div class="min-h-screen flex flex-col">
    <header class="w-full max-w-5xl mx-auto mt-6 rounded-full glass-effect px-6 py-3 flex items-center justify-between shadow-lg">
      <a href="/" class="flex items-center gap-3">
        <img src="../logo.png" alt="toolfoliohub" class="h-8 w-auto dark:hidden">
        <img src="../darkmodelogo.png" alt="toolfoliohub" class="h-8 w-auto hidden dark:block">
        <span class="brand-title text-xs sm:text-sm">toolfoliohub</span>
      </a>
      <div class="flex items-center gap-4">
        <a href="/tools" class="text-sm font-semibold text-primary">⬅ Back to Tools</a>
        <button id="darkModeToggle" class="p-2 rounded-full hover:bg-black/5 dark:hover:bg-white/5 transition-colors">
          <span class="material-symbols-outlined text-text-light dark:text-text-dark">dark_mode</span>
        </button>
      </div>
    </header>

    <main class="flex-1 px-4 py-10">
      <section class="tool-shell rounded-3xl glass-effect p-8 shadow-xl space-y-6">
        <div>
          <p class="text-xs uppercase tracking-[0.4em] text-muted-light dark:text-muted-dark">Developer Tools</p>
          <h1 class="mt-2 text-3xl font-bold">Apify URL Tool</h1>
          <p class="mt-2 text-muted-light dark:text-muted-dark">
            Send a URL to a configured Apify actor and inspect the JSON result.
            Use this only for URLs you are legally allowed to process.
          </p>
        </div>

        <form id="apifyForm" class="space-y-4">
          <div class="space-y-2">
            <label for="targetUrl" class="block text-sm font-medium text-text-light dark:text-text-dark">
              Target URL
            </label>
            <input
              id="targetUrl"
              type="url"
              required
              placeholder="https://example.com"
              class="w-full rounded-2xl border border-white/40 bg-white/80 dark:border-white/10 dark:bg-background-dark/60 px-4 py-2 text-sm outline-none focus:ring-2 focus:ring-primary"
            />
          </div>
          <div class="space-y-2">
            <label for="mode" class="block text-sm font-medium text-text-light dark:text-text-dark">
              Mode / Options
            </label>
            <select
              id="mode"
              class="w-full rounded-2xl border border-white/40 bg-white/80 dark:border-white/10 dark:bg-background-dark/60 px-4 py-2 text-sm outline-none focus:ring-2 focus:ring-primary"
            >
              <option value="metadata_only">Metadata only</option>
              <option value="default">Default (actor-specific)</option>
            </select>
          </div>
          <button
            type="submit"
            class="rounded-full bg-primary text-white px-6 py-2 text-sm font-semibold hover:bg-primary/90 transition-colors"
          >
            Run via Apify
          </button>
        </form>

        <div class="space-y-2">
          <p class="text-sm font-medium text-text-light dark:text-text-dark">Result</p>
          <pre
            id="apifyResult"
            class="w-full min-h-[160px] rounded-2xl bg-white/70 dark:bg-background-dark/70 border border-white/40 dark:border-white/10 text-xs p-4 overflow-x-auto whitespace-pre-wrap text-text-light dark:text-text-dark font-mono"
          >Waiting for input…</pre>
        </div>
      </section>
    </main>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const form = document.getElementById('apifyForm');
      const urlInput = document.getElementById('targetUrl');
      const modeSelect = document.getElementById('mode');
      const resultEl = document.getElementById('apifyResult');
      const submitBtn = form.querySelector('button[type="submit"]');

      if (!form || !urlInput || !modeSelect || !resultEl) return;

      form.addEventListener('submit', async (event) => {
        event.preventDefault();

        const targetUrl = urlInput.value.trim();
        const mode = modeSelect.value;

        if (!targetUrl) {
          resultEl.textContent = 'Please enter a URL.';
          return;
        }

        // Disable submit button and show loading
        submitBtn.disabled = true;
        submitBtn.textContent = 'Processing...';
        resultEl.textContent = 'Processing via Apify…';

        try {
          const response = await fetch('/api/apify-proxy', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({
              targetUrl,
              options: { mode },
            }),
          });

          const data = await response.json();

          if (!response.ok || !data.success) {
            let errorMsg = 'Error: ' + (data.error || 'Unknown error');
            if (data.details) {
              errorMsg += '\n\nDetails: ' + data.details;
            }
            if (data.status) {
              errorMsg += '\nStatus: ' + data.status;
            }
            if (data.fullError) {
              errorMsg += '\n\nFull Error:\n' + JSON.stringify(data.fullError, null, 2);
            }
            resultEl.textContent = errorMsg;
            return;
          }

          resultEl.textContent = JSON.stringify(data.items, null, 2);
        } catch (error) {
          console.error(error);
          resultEl.textContent = 'Network error. Please try again.';
        } finally {
          // Re-enable submit button
          submitBtn.disabled = false;
          submitBtn.textContent = 'Run via Apify';
        }
      });
    });
  </script>
  <script src="../tools-shared-script.js"></script>
</body>
</html>

